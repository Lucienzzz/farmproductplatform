<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>register</title>
</head>
<script type="text/javascript" th:src="@{js/jquery-3.6.0.js}"></script>
<body>
<form action="/user/doRegister" method="post">
    用户名<label>
    <input id="username" type="text" name="username"><span></span>
</label><br>
    密 码<label>
    <input type="password" name="password">
</label><br>
    <label>
        <input type="radio" name="status" value="1">
    </label>管理员
    <label>
        <input type="radio" name="status" value="0" checked="checked">
    </label>普通用户<br>
    <label>
        <input type="text" name="code">
    </label><img id="nextPic" alt="验证码加载错误" th:src="@{/code}">验证码<a href="javascript:clickNext()">换一张</a><br>
    <button type="submit">注册</button>
</form>
</body>
<script type="text/javascript">
    function clickNext() {
        let imgSrc = document.getElementById("nextPic");
        imgSrc.src = imgSrc.src+"?" + Math.random();
    }
    $("#username").blur(function () {
        let username = $("#username").val();
        $.ajax({
            type: 'get',
            data : {username: username},
            url: "/isDuplicated",
            success: function (res) {
                if (res !== 0) {
                    $("span").text("输入的用户名重复了,请重新输入").css("color", "red");
                } else {
                    $("span").text("用户名可以使用").css("color", "green");
                }
            }
        })
    });
</script>
</html>

